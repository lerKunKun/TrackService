# 用户故事 (User Stories)

## Epic 1: 店铺管理

### US-001: 添加Shopify店铺
**作为** 店铺管理员
**我想要** 添加我的Shopify店铺到系统
**以便于** 系统能够自动获取和追踪订单的物流信息

**验收标准：**
- [ ] 能够填写店铺名称、店铺URL
- [ ] 能够配置Shopify API Key和Access Token
- [ ] 能够选择店铺时区
- [ ] 系统验证API配置的有效性
- [ ] 保存成功后跳转到店铺列表
- [ ] 显示成功提示消息

**优先级：** P0 (必须)
**故事点数：** 5

---

### US-002: 查看店铺列表
**作为** 店铺管理员
**我想要** 查看所有已添加的店铺列表
**以便于** 管理和查看店铺的基本信息

**验收标准：**
- [ ] 以表格形式展示所有店铺
- [ ] 显示店铺名称、平台类型、店铺URL、创建时间
- [ ] 支持编辑店铺信息
- [ ] 支持删除店铺（需二次确认）
- [ ] 显示每个店铺关联的订单数量

**优先级：** P0
**故事点数：** 3

---

### US-003: 编辑店铺信息
**作为** 店铺管理员
**我想要** 修改店铺的配置信息
**以便于** 更新API密钥或其他配置

**验收标准：**
- [ ] 能够修改店铺名称、API配置
- [ ] 修改API配置后重新验证有效性
- [ ] 保存成功后更新列表
- [ ] 显示操作结果

**优先级：** P1
**故事点数：** 3

---

## Epic 2: 运单导入

### US-004: CSV批量导入运单
**作为** 运营人员
**我想要** 通过CSV文件批量导入运单号
**以便于** 快速批量添加需要追踪的运单

**验收标准：**
- [ ] 提供CSV模板下载链接
- [ ] 支持选择文件上传（最大10MB）
- [ ] 上传前预览CSV内容（前10行）
- [ ] 验证CSV格式（必需字段：tracking_number, carrier_code）
- [ ] 显示导入进度条
- [ ] 导入完成后显示结果统计：
  - 总数
  - 成功数量
  - 失败数量
  - 失败原因列表
- [ ] 支持下载失败记录

**优先级：** P0
**故事点数：** 8

**CSV格式示例：**
```csv
tracking_number,carrier_code,order_id,remarks
1Z999AA10123456784,ups,#1001,
LZ123456789CN,4px,#1002,Priority
```

---

### US-005: 手动添加单个运单
**作为** 客服人员
**我想要** 手动输入单个运单号
**以便于** 为客户快速添加物流追踪

**验收标准：**
- [ ] 提供运单添加表单
- [ ] 必填字段：运单号、承运商代码
- [ ] 可选字段：关联订单号、备注
- [ ] 承运商代码支持下拉选择和搜索
- [ ] 实时验证运单号格式
- [ ] 添加成功后自动跳转到运单详情页
- [ ] 支持"添加并继续"功能

**优先级：** P0
**故事点数：** 5

---

### US-006: 自动同步Shopify订单（第二期）
**作为** 店铺管理员
**我想要** 系统自动从Shopify获取订单和运单信息
**以便于** 无需手动导入，减少工作量

**验收标准：**
- [ ] 支持手动触发同步
- [ ] 支持设置自动同步周期
- [ ] 显示同步进度和状态
- [ ] 同步新订单和更新的订单
- [ ] 自动提取Fulfillment中的tracking信息
- [ ] 记录同步日志

**优先级：** P1
**故事点数：** 13

---

## Epic 3: 运单查询和展示

### US-007: 查看运单列表
**作为** 运营人员
**我想要** 查看所有运单的列表
**以便于** 了解整体物流情况

**验收标准：**
- [ ] 表格展示运单列表
- [ ] 显示字段：运单号、承运商、状态、最后更新时间、订单号
- [ ] 支持分页（每页20/50/100条可选）
- [ ] 状态用不同颜色标识（进行中/已送达/异常）
- [ ] 点击运单号跳转到详情页
- [ ] 支持多选（用于批量操作）
- [ ] 列表默认按最后更新时间倒序排列

**优先级：** P0
**故事点数：** 8

---

### US-008: 搜索运单
**作为** 客服人员
**我想要** 通过运单号或订单号搜索
**以便于** 快速找到客户咨询的运单

**验收标准：**
- [ ] 提供搜索框
- [ ] 支持运单号模糊搜索
- [ ] 支持订单号搜索
- [ ] 实时搜索（输入时自动查询）
- [ ] 搜索结果高亮显示匹配内容
- [ ] 无结果时显示友好提示

**优先级：** P0
**故事点数：** 5

---

### US-009: 筛选运单
**作为** 运营人员
**我想要** 按不同条件筛选运单
**以便于** 聚焦查看特定类型的运单

**验收标准：**
- [ ] 筛选条件：
  - 店铺（多选）
  - 状态（多选：运输中/已签收/异常/信息收录等）
  - 承运商（多选）
  - 时间范围（创建时间/更新时间）
- [ ] 支持组合筛选
- [ ] 筛选条件可清除
- [ ] 显示当前筛选条件标签
- [ ] 筛选结果数量提示

**优先级：** P0
**故事点数：** 8

---

### US-010: 查看运单详情
**作为** 客服人员
**我想要** 查看运单的详细信息和物流轨迹
**以便于** 回答客户的物流咨询

**验收标准：**
- [ ] 基本信息区域：
  - 运单号（支持复制）
  - 承运商名称和图标
  - 当前状态
  - 创建时间、最后更新时间
- [ ] 物流轨迹时间轴：
  - 按时间倒序展示（最新在上）
  - 每个节点显示：时间、状态、位置、详细描述
  - 当前节点高亮显示
- [ ] 关联订单信息：
  - 订单号
  - 客户姓名、联系方式
  - 订单金额
- [ ] 操作按钮：
  - 手动同步
  - 删除运单
  - 返回列表

**优先级：** P0
**故事点数：** 8

---

### US-011: 查看物流轨迹
**作为** 客服人员
**我想要** 清晰地看到物流每个节点的信息
**以便于** 了解包裹当前位置和预计送达时间

**验收标准：**
- [ ] 时间轴垂直展示
- [ ] 每个节点显示：
  - 日期时间
  - 物流状态
  - 地点/城市
  - 详细描述
- [ ] 最新状态在顶部
- [ ] 关键节点（已发货/运输中/派送中/已签收）用图标区分
- [ ] 异常状态用红色标识

**优先级：** P0
**故事点数：** 5

---

## Epic 4: 运单操作

### US-012: 删除单个运单
**作为** 运营人员
**我想要** 删除错误或无效的运单
**以便于** 保持数据的准确性

**验收标准：**
- [ ] 在列表页和详情页都能删除
- [ ] 删除前弹出确认对话框
- [ ] 确认对话框显示运单号
- [ ] 删除成功后显示提示消息
- [ ] 删除后刷新列表

**优先级：** P0
**故事点数：** 3

---

### US-013: 批量删除运单
**作为** 运营人员
**我想要** 批量删除多个运单
**以便于** 快速清理无效数据

**验收标准：**
- [ ] 支持多选运单
- [ ] 显示已选择数量
- [ ] 点击批量删除按钮
- [ ] 确认对话框显示选中数量
- [ ] 删除成功后显示删除结果
- [ ] 取消选择所有运单

**优先级：** P0
**故事点数：** 5

---

### US-014: 手动同步运单状态
**作为** 客服人员
**我想要** 手动触发运单状态更新
**以便于** 获取最新的物流信息

**验收标准：**
- [ ] 在详情页提供"立即同步"按钮
- [ ] 点击后显示加载状态
- [ ] 同步成功后刷新页面数据
- [ ] 显示同步时间
- [ ] 同步失败显示错误信息

**优先级：** P1
**故事点数：** 3

---

### US-015: 批量导出运单
**作为** 运营人员
**我想要** 导出运单列表为CSV文件
**以便于** 进行数据分析或归档

**验收标准：**
- [ ] 导出当前筛选结果
- [ ] 导出字段：运单号、承运商、状态、创建时间、更新时间、订单号
- [ ] 文件名包含导出时间
- [ ] 大数据量时显示导出进度
- [ ] 导出完成后自动下载

**优先级：** P1
**故事点数：** 5

---

## Epic 5: 系统集成

### US-016: 接收17Track Webhook推送
**作为** 系统
**我需要** 接收17Track的Webhook推送
**以便于** 实时更新运单状态

**技术要求：**
- [ ] 提供Webhook接收接口
- [ ] 验证17Track签名
- [ ] 记录Webhook日志
- [ ] 异步处理推送数据
- [ ] 500ms内返回响应
- [ ] 更新运单状态
- [ ] 新增物流事件记录
- [ ] 更新Redis缓存

**优先级：** P0
**故事点数：** 8

---

### US-017: 向17Track注册运单
**作为** 系统
**我需要** 在新增运单时向17Track注册
**以便于** 开始追踪物流信息

**技术要求：**
- [ ] 调用17Track注册接口
- [ ] 支持批量注册
- [ ] 注册失败重试（最多3次）
- [ ] 记录注册结果
- [ ] 异步处理注册任务（使用消息队列）

**优先级：** P0
**故事点数：** 8

---

### US-018: 定时同步运单状态
**作为** 系统
**我需要** 定期主动查询运单状态
**以便于** 补充Webhook可能遗漏的更新

**技术要求：**
- [ ] 定时任务扫描需要同步的运单
- [ ] 批量调用17Track查询接口
- [ ] 更新运单状态和事件
- [ ] 失败重试机制
- [ ] 更新next_sync_at
- [ ] 记录同步日志

**优先级：** P1
**故事点数：** 13

---

## Epic 6: 异常处理和监控

### US-019: API调用失败重试
**作为** 系统
**我需要** 在17Track API调用失败时自动重试
**以便于** 提高系统可靠性

**技术要求：**
- [ ] 失败自动重试，最多3次
- [ ] 使用指数退避策略
- [ ] 重试失败记录到sync_jobs表
- [ ] 使用消息队列实现异步重试
- [ ] 监控重试成功率

**优先级：** P0
**故事点数：** 8

---

### US-020: 异常运单提醒（第二期）
**作为** 运营人员
**我想要** 在运单状态异常时收到提醒
**以便于** 及时处理问题

**验收标准：**
- [ ] 识别异常状态（长时间无更新、退回、派送失败等）
- [ ] 在列表页标识异常运单
- [ ] 提供异常运单汇总视图
- [ ] 支持邮件/站内消息提醒

**优先级：** P2
**故事点数：** 8

---

## Epic 7: 数据统计（第二期）

### US-021: 查看运单统计数据
**作为** 店铺管理员
**我想要** 查看运单的统计数据
**以便于** 了解整体物流情况

**验收标准：**
- [ ] 统计卡片：
  - 总运单数
  - 运输中数量
  - 已签收数量
  - 异常数量
- [ ] 按承运商统计图表
- [ ] 按状态分布饼图
- [ ] 近7天/30天运单趋势图
- [ ] 支持按店铺筛选

**优先级：** P2
**故事点数：** 13

---

## Epic 8: 订单管理（第二期）

### US-022: 查看订单列表
**作为** 运营人员
**我想要** 查看所有订单列表
**以便于** 了解订单的发货和物流情况

**验收标准：**
- [ ] 展示订单基本信息
- [ ] 显示订单关联的运单状态
- [ ] 支持按店铺、状态筛选
- [ ] 支持订单号搜索
- [ ] 分页展示

**优先级：** P2
**故事点数：** 8

---

### US-023: 查看订单详情
**作为** 客服人员
**我想要** 查看订单的详细信息
**以便于** 了解客户订单的完整信息

**验收标准：**
- [ ] 订单基本信息（订单号、客户、金额）
- [ ] 商品列表
- [ ] 关联的所有包裹和运单
- [ ] 每个运单的当前状态
- [ ] 物流状态时间轴

**优先级：** P2
**故事点数：** 8

---

## 故事地图 (Story Mapping)

### Sprint 1 - MVP核心功能（2周）
- US-001: 添加Shopify店铺
- US-002: 查看店铺列表
- US-005: 手动添加单个运单
- US-007: 查看运单列表

### Sprint 2 - 导入和详情（2周）
- US-004: CSV批量导入运单
- US-008: 搜索运单
- US-010: 查看运单详情
- US-011: 查看物流轨迹

### Sprint 3 - 17Track集成（2周）
- US-016: 接收17Track Webhook推送
- US-017: 向17Track注册运单
- US-019: API调用失败重试

### Sprint 4 - 运单操作（1周）
- US-009: 筛选运单
- US-012: 删除单个运单
- US-013: 批量删除运单
- US-014: 手动同步运单状态

### Sprint 5 - 优化和扩展（2周）
- US-003: 编辑店铺信息
- US-015: 批量导出运单
- US-018: 定时同步运单状态

### 后续迭代
- US-006: 自动同步Shopify订单
- US-020: 异常运单提醒
- US-021: 查看运单统计数据
- US-022: 查看订单列表
- US-023: 查看订单详情

---

## 用户角色定义

### 店铺管理员
- 主要职责：管理店铺配置、查看整体数据
- 使用频率：中等
- 技术水平：中等

### 运营人员
- 主要职责：批量导入运单、监控物流状态、数据分析
- 使用频率：高
- 技术水平：中等

### 客服人员
- 主要职责：查询运单、回复客户咨询
- 使用频率：非常高
- 技术水平：低-中等

---

## 非功能性用户故事

### US-024: 系统响应时间
**作为** 任何用户
**我想要** 系统快速响应
**以便于** 提高工作效率

**验收标准：**
- [ ] 列表页加载 < 2秒
- [ ] 搜索响应 < 1秒
- [ ] 详情页加载 < 1.5秒
- [ ] API调用 < 500ms

---

### US-025: 数据安全
**作为** 店铺管理员
**我想要** 我的店铺数据和API密钥安全存储
**以便于** 防止数据泄露

**验收标准：**
- [ ] API密钥加密存储
- [ ] HTTPS传输
- [ ] SQL注入防护
- [ ] XSS防护
- [ ] 用户认证和授权

---

### US-026: 系统可用性
**作为** 系统管理员
**我想要** 系统稳定可靠
**以便于** 确保业务连续性

**验收标准：**
- [ ] 系统可用性 > 99.5%
- [ ] 异常自动恢复
- [ ] 降级方案
- [ ] 监控和告警
